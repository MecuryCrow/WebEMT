{% extends "layout.html" %}
{% block content %}

<h2>Captured URLs</h2>

{% if reconstructed_urls or non_reconstructed_urls or total_non_reconstructed > 0 %}

<!-- Reconstructed Pages Table -->
{% if reconstructed_urls %}
<h4 class="text-success mt-4">✓ Reconstructed Pages ({{ reconstructed_urls|length }})</h4>
<div class="table-responsive">
    <table class="table table-dark table-striped table-hover table-translucent">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col" style="max-width: 400px;">URL</th>
                <th scope="col">Type</th>
            </tr>
        </thead>
        <tbody>
            {% for item in reconstructed_urls %}
            <tr>
                <th scope="row">{{ loop.index }}</th>
                <td style="max-width: 400px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                    title="{{ item.original }}">
                    <a href="{{ item.link }}" target="_blank" class="text-decoration-none text-info">
                        {{ item.original }}
                    </a>
                </td>
                <td><span class="badge bg-success">{{ item.mime_type }}</span></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- Non-Reconstructed URLs Table -->
{% if non_reconstructed_urls or total_non_reconstructed > 0 %}
<h4 class="text-danger mt-4">⊗ Non-Reconstructed URLs ({{ total_non_reconstructed }})</h4>
<div class="table-responsive">
    <table class="table table-dark table-striped table-hover table-translucent">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col" style="max-width: 400px;">URL</th>
                <th scope="col">Type</th>
            </tr>
        </thead>
        <tbody>
            {% for item in non_reconstructed_urls %}
            <tr>
                <th scope="row">{{ ((current_page - 1) * 10) + loop.index }}</th>
                <td class="text-light"
                    style="max-width: 400px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                    title="{{ item.original }}">{{ item.original }}</td>
                <td><span class="badge bg-secondary">{{ item.mime_type }}</span></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination Controls -->
{% if total_pages > 1 %}
<nav aria-label="Page navigation" class="mt-3">
    <ul class="pagination justify-content-center">
        {% if current_page > 1 %}
        <li class="page-item">
            <a class="page-link" href="?page={{ current_page - 1 }}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">&laquo;</span>
        </li>
        {% endif %}

        {% for p in range(1, total_pages + 1) %}
        {% if p == current_page %}
        <li class="page-item active"><span class="page-link">{{ p }}</span></li>
        {% elif p <= 3 or p> total_pages - 3 or (p >= current_page - 1 and p <= current_page + 1) %} <li
                class="page-item"><a class="page-link" href="?page={{ p }}">{{ p }}</a></li>
                {% elif p == 4 or p == total_pages - 3 %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
                {% endif %}
                {% endfor %}

                {% if current_page < total_pages %} <li class="page-item">
                    <a class="page-link" href="?page={{ current_page + 1 }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                    </li>
                    {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">&raquo;</span>
                    </li>
                    {% endif %}
    </ul>
    <p class="text-center text-muted mt-2">
        Showing {{ (current_page - 1) * 10 + 1 }}-{{ [current_page * 10, total_non_reconstructed] | min }} of {{
        total_non_reconstructed }} non-reconstructed URLs
    </p>
</nav>
{% endif %}
{% endif %}

{% else %}
<p class="text-muted">No captured URLs yet.</p>
{% endif %}

{% endblock %}